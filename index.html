<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jarvis - Neon Rose V20.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --bg: #1A1A1C; --card: #2C2C2E; --p: #FF007F; 
            --blue: #00D2FF; --g: #FFD700; --text: #ffffff; 
            --highlight: #FF6347; --border: #3d3d40;
        }
        
        body { 
            background: var(--bg); color: var(--text); 
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; 
            margin: 0; display: grid; 
            grid-template-columns: 320px 1fr 380px; 
            height: 100vh; gap: 15px; padding: 15px; overflow: hidden; 
            box-sizing: border-box;
        }

        .panel { 
            background: var(--card); border-radius: 24px; 
            padding: 20px; border: 1px solid var(--border); 
            display: flex; flex-direction: column; position: relative; 
            overflow: hidden;
        }

        .header { 
            font-size: 12px; text-transform: uppercase; letter-spacing: 2px; 
            color: #777; margin-bottom: 15px; border-bottom: 1px solid #444; 
            padding-bottom: 8px; flex-shrink: 0;
        }
        .header span { color: var(--p); text-shadow: 0 0 10px var(--p); }

        /* åˆ—è¡¨å®¹å™¨ */
        .scroll-area { flex: 1; overflow-y: auto; padding-right: 5px; }
        .scroll-area::-webkit-scrollbar { width: 4px; }
        .scroll-area::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .input-bar { 
            background: #000; border: 1px solid #444; 
            border-radius: 12px; padding: 8px; 
            display: flex; gap: 8px; margin-top: 10px; flex-shrink: 0;
        }
        input { 
            background: transparent; border: none; color: white; 
            outline: none; font-size: 14px; flex: 1;
        }
        button.p-btn { 
            background: var(--p); color: #000; border: none; 
            padding: 8px 15px; border-radius: 8px; font-weight: bold; 
            cursor: pointer; transition: 0.3s;
        }
        button.p-btn:hover { background: var(--highlight); transform: scale(1.05); }

        /* ä»»åŠ¡ä¸å•†åº—å¡ç‰‡ */
        .item-card {
            background: #38383a; border-radius: 12px; padding: 12px;
            margin-bottom: 10px; border-left: 4px solid var(--p);
            display: flex; justify-content: space-between; align-items: center;
            transition: 0.3s; cursor: pointer;
        }
        .item-card:hover { background: #444; transform: translateX(5px); }
        .item-card.completed { border-left-color: #555; opacity: 0.6; }

        /* ç»ˆç«¯æ ·å¼ */
        .terminal { 
            flex: 1; background: #111; border: 1px solid #444; 
            border-radius: 15px; padding: 15px; font-family: 'Courier New', monospace; 
            font-size: 13px; color: var(--blue); line-height: 1.6; overflow-y: auto; 
        }

        @media (max-width: 1100px) { 
            body { grid-template-columns: 1fr; overflow-y: auto; height: auto; } 
            .panel { height: 500px; }
        }
    </style>
</head>
<body>

    <div class="panel">
        <div class="header">STATUS // <span>AGENT RANK: ALPHA</span></div>
        <canvas id="radar" style="max-height: 160px;"></canvas>
        
        <div style="margin-top:20px;">
            <div style="color:#555; font-size:10px;">AVAILABLE CREDITS</div>
            <div style="font-size:32px; font-weight:bold; color:var(--g);">ğŸª™ <span id="coinCount">1000</span></div>
        </div>

        <div class="header" style="margin-top:20px;">DESIRE SHOP // <span>å…‘æ¢</span></div>
        <div id="shopList" class="scroll-area"></div>
        <div class="input-bar">
            <input type="text" id="shopName" placeholder="æƒ³å…‘æ¢çš„äº‹...">
            <input type="number" id="shopPrice" placeholder="é‡‘å¸" style="width:60px;">
            <button class="p-btn" onclick="addShopItem()">+</button>
        </div>
    </div>

    <div class="panel">
        <div class="header">TIMELINE // <span>CORE MISSIONS</span></div>
        <div id="missionList" class="scroll-area"></div>
        <div class="input-bar">
            <input type="text" id="mTitle" placeholder="éƒ¨ç½²æ–°ä»»åŠ¡...">
            <input type="time" id="mTime" style="width:100px; color:white; background:transparent; border:none;">
            <button class="p-btn" onclick="addMission()">DEPLOY</button>
        </div>
    </div>

    <div class="panel">
        <div class="header">JARVIS CORE // <span>INTELLIGENCE</span></div>
        <div class="terminal" id="jarvisMsg">> æ­£åœ¨åˆå§‹åŒ–æ·±åº¦è®°å¿†æ¨¡å—...<br>> ç³»ç»Ÿå°±ç»ªã€‚è¯·è¾“å…¥æŒ‡ä»¤ã€‚</div>
        <div class="input-bar" style="margin-top:15px;">
            <input type="text" id="chatInput" placeholder="æ±‡æŠ¥å¿ƒæƒ…æˆ–å·¥ä½œ..." onkeypress="if(event.key==='Enter') sendChat()">
            <button class="p-btn" onclick="sendChat()">SEND</button>
        </div>
        <button class="p-btn" style="margin-top:10px; width:100%; background:transparent; border:1px solid var(--p); color:var(--p);" onclick="analyzeSystem()">åˆ†æå½“å‰çŠ¶æ€å¹¶æä¾›å»ºè®®</button>
    </div>

    <script>
        // --- æ ¸å¿ƒæ•°æ®çŠ¶æ€ ---
        let state = {
            coins: parseInt(localStorage.getItem('jarvis_coins')) || 1000,
            missions: JSON.parse(localStorage.getItem('jarvis_missions')) || [
                { id: 1, title: "ç³»ç»Ÿæ¶æ„ä¼˜åŒ–", time: "09:00", done: false },
                { id: 2, title: "æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒ", time: "14:00", done: true }
            ],
            shop: JSON.parse(localStorage.getItem('jarvis_shop')) || [
                { id: 1, name: "å–ä¸€æ¯å¥¶èŒ¶", price: 200, icon: "ğŸ§‹" },
                { id: 2, name: "ç©1å°æ—¶æ¸¸æˆ", price: 500, icon: "ğŸ®" }
            ]
        };

        // --- åˆå§‹åŒ– ---
        function init() {
            renderAll();
            initRadar();
            printTerminal("æ¬¢è¿å›æ¥ï¼Œå…ˆç”Ÿã€‚å½“å‰ç³»ç»Ÿè¿è¡Œç¨³å®šã€‚");
        }

        // --- æ¸²æŸ“é€»è¾‘ ---
        function renderAll() {
            // æ›´æ–°é‡‘å¸
            document.getElementById('coinCount').innerText = state.coins;
            localStorage.setItem('jarvis_coins', state.coins);

            // æ¸²æŸ“ä»»åŠ¡
            const mList = document.getElementById('missionList');
            mList.innerHTML = state.missions.map(m => `
                <div class="item-card ${m.done ? 'completed' : ''}" onclick="toggleMission(${m.id})">
                    <div>
                        <div style="font-size:14px;">${m.title}</div>
                        <div style="font-size:10px; color:#777;">EXPECTED: ${m.time}</div>
                    </div>
                    <div style="color:${m.done ? '#555' : 'var(--p)'}">${m.done ? 'âœ“' : 'â—'}</div>
                </div>
            `).join('');
            localStorage.setItem('jarvis_missions', JSON.stringify(state.missions));

            // æ¸²æŸ“å•†åº—
            const sList = document.getElementById('shopList');
            sList.innerHTML = state.shop.map(s => `
                <div class="item-card" onclick="buyItem(${s.id}, ${s.price})">
                    <div>${s.icon || 'ğŸ'} ${s.name}</div>
                    <div style="color:var(--g); font-weight:bold;">-${s.price}</div>
                </div>
            `).join('');
            localStorage.setItem('jarvis_shop', JSON.stringify(state.shop));
        }

        // --- äº¤äº’é€»è¾‘ ---
        function addMission() {
            const title = document.getElementById('mTitle').value;
            const time = document.getElementById('mTime').value || "12:00";
            if (!title) return;
            state.missions.unshift({ id: Date.now(), title, time, done: false });
            document.getElementById('mTitle').value = '';
            renderAll();
            printTerminal(`æ–°ä»»åŠ¡å·²éƒ¨ç½²: ${title}`);
        }

        function toggleMission(id) {
            const m = state.missions.find(x => x.id === id);
            if (m && !m.done) {
                m.done = true;
                state.coins += 50; // å®Œæˆä»»åŠ¡å¥–åŠ±
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#FF007F', '#00D2FF'] });
                printTerminal(`ä»»åŠ¡å®Œæˆï¼è·å¾— 50 ç§¯åˆ†å¥–åŠ±ã€‚`);
            } else if (m) {
                m.done = false;
            }
            renderAll();
        }

        function addShopItem() {
            const name = document.getElementById('shopName').value;
            const price = parseInt(document.getElementById('shopPrice').value);
            if (!name || isNaN(price)) return;
            state.shop.push({ id: Date.now(), name, price, icon: "âœ¨" });
            document.getElementById('shopName').value = '';
            document.getElementById('shopPrice').value = '';
            renderAll();
        }

        function buyItem(id, price) {
            if (state.coins >= price) {
                state.coins -= price;
                printTerminal(`å…‘æ¢æˆåŠŸã€‚å‰©ä½™ç§¯åˆ†: ${state.coins}`);
                renderAll();
                // å¯ä»¥åŠ ä¸ªç‰¹æ®Šç‰¹æ•ˆ
                document.body.style.backgroundColor = "#222";
                setTimeout(() => document.body.style.backgroundColor = var(--bg), 100);
            } else {
                printTerminal("è­¦å‘Šï¼šç§¯åˆ†ä¸è¶³ï¼Œæ— æ³•å…‘æ¢è¯¥æ¬²æœ›ã€‚å»ºè®®å…ˆå®Œæˆä»»åŠ¡ã€‚");
            }
        }

        // --- AI ç»ˆç«¯é€»è¾‘ ---
        function printTerminal(text) {
            const box = document.getElementById('jarvisMsg');
            const newLine = document.createElement('div');
            newLine.innerHTML = `> ${text}`;
            box.appendChild(newLine);
            box.scrollTop = box.scrollHeight;
        }

        function sendChat() {
            const input = document.getElementById('chatInput');
            if (!input.value) return;
            printTerminal(`<span style="color:#eee">${input.value}</span>`);
            
            // æ¨¡æ‹Ÿ AI å›å¤
            setTimeout(() => {
                const replies = [
                    "è®°å½•å·²åŒæ­¥è‡³äº‘ç«¯ã€‚ä½ çš„æƒ…ç»ªæ³¢åŠ¨å¤„äºæ­£å¸¸èŒƒå›´å†…ã€‚",
                    "åˆ†æä¸­... å»ºè®®ä¼˜å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§ä»»åŠ¡ã€‚",
                    "æ˜ç™½ã€‚å·²æ›´æ–°ä½ çš„å¿ƒç†æ¡£æ¡ˆã€‚éœ€è¦è°ƒæ•´ä»Šæ—¥è®¡åˆ’å—ï¼Ÿ",
                    "åŠ æ²¹ï¼Œå…ˆç”Ÿã€‚ä½ æ˜¯æœ€æ£’çš„ã€‚ (æ¨¡æ‹Ÿæƒ…æ„Ÿåé¦ˆæ¨¡å— V2.1)"
                ];
                printTerminal(replies[Math.floor(Math.random()*replies.length)]);
            }, 600);
            
            input.value = '';
        }

        function analyzeSystem() {
            const activeMissions = state.missions.filter(m => !m.done).length;
            printTerminal(`ç³»ç»Ÿåˆ†ææŠ¥å‘Šï¼šç›®å‰æœ‰ ${activeMissions} ä¸ªå¾…åŠäº‹é¡¹ã€‚å»ºè®®å…ˆä¸“æ³¨äºæœ€ç´§æ€¥çš„ä¸€é¡¹ã€‚`);
        }

        // --- å›¾è¡¨åˆå§‹åŒ– ---
        function initRadar() {
            const ctx = document.getElementById('radar').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['æ•ˆç‡', 'ä½“èƒ½', 'ä¸“æ³¨', 'åˆ›æ„', 'ç¤¾äº¤', 'å¿ƒæ€'],
                    datasets: [{
                        label: 'Agent Stats',
                        data: [85, 60, 90, 75, 50, 80],
                        backgroundColor: 'rgba(255, 0, 127, 0.2)',
                        borderColor: '#FF007F',
                        pointBackgroundColor: '#00D2FF'
                    }]
                },
                options: {
                    scales: { r: { grid: { color: '#444' }, angleLines: { color: '#444' }, ticks: { display: false } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        init();
    </script>
</body>
</html>
