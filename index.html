<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jarvis - Neon Rose V20.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --bg: #1A1A1C; --card: #2C2C2E; --p: #FF007F; --blue: #00D2FF; --g: #FFD700; --text: #ffffff; --highlight: #FF6347; }
        
        body { 
            background: var(--bg); color: var(--text); 
            font-family: 'PingFang SC', sans-serif; 
            margin: 0; display: grid; 
            grid-template-columns: 320px 1fr 380px; 
            height: 100vh; gap: 15px; padding: 15px; overflow: hidden; 
        }

        .panel { 
            background: var(--card); border-radius: 24px; padding: 20px; 
            border: 1px solid #333; display: flex; flex-direction: column; 
            position: relative; overflow: hidden;
        }

        .header { 
            font-size: 12px; text-transform: uppercase; letter-spacing: 2px; 
            color: #777; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 8px; 
        }
        .header span { color: var(--p); text-shadow: 0 0 10px var(--p); }

        .input-bar { 
            background: #000; border: 1px solid #444; border-radius: 12px; 
            padding: 8px 12px; display: flex; gap: 8px; margin-top: 10px; 
        }

        input { background: transparent; border: none; color: white; outline: none; flex: 1; font-size: 14px; }
        
        .p-btn { 
            background: var(--p); color: #000; border: none; border-radius: 12px;
            font-weight: bold; cursor: pointer; transition: 0.3s; padding: 8px 15px;
        }
        .p-btn:hover { background: var(--highlight); transform: scale(1.05); }

        .terminal { 
            flex: 1; background: #111; border: 1px solid #444; border-radius: 15px; 
            padding: 15px; font-family: monospace; font-size: 12px; color: var(--blue); 
            line-height: 1.6; overflow-y: auto; 
        }

        .scroll-area { flex: 1; overflow-y: auto; }
        .item-card {
            background: #333; border-radius: 10px; padding: 12px; margin-bottom: 10px;
            cursor: pointer; display: flex; justify-content: space-between; align-items: center;
            border-left: 4px solid var(--p); transition: 0.3s;
        }
        .item-card:hover { background: #444; }
        .item-card.done { opacity: 0.5; border-left-color: #777; text-decoration: line-through; }

        @media (max-width: 1024px) { body { grid-template-columns: 1fr; overflow-y: auto; height: auto; } .panel { height: 500px; } }
    </style>
</head>
<body id="main">
    <div class="panel">
        <div class="header">STATUS // <span>AGENT RANK</span></div>
        <canvas id="radar" style="max-height: 180px;"></canvas>
        <div style="margin-top:15px;">
            <div style="color:#555; font-size:10px;">CREDITS</div>
            <div style="font-size:32px; font-weight:bold; color:var(--g);">ğŸª™ <span id="coins">1000</span></div>
        </div>
        <div class="header" style="margin-top:20px;">DESIRE SHOP // <span>å…‘æ¢</span></div>
        <div id="shopList" class="scroll-area"></div>
        <div class="input-bar">
            <input type="text" id="shopIcon" placeholder="ğŸ¨" style="width:30px; flex:none;">
            <input type="text" id="shopName" placeholder="æƒ³å…‘æ¢çš„äº‹...">
            <input type="number" id="shopPrice" placeholder="é‡‘å¸" style="width:50px; flex:none;">
            <button class="p-btn" onclick="addShopItem()">+</button>
        </div>
    </div>

    <div class="panel">
        <div class="header">TIMELINE // <span>24H LOGGING</span></div>
        <div id="timeline" class="scroll-area"></div>
        <div class="input-bar">
            <input type="text" id="mTitle" placeholder="å‘å¸ƒæ–°ä»»åŠ¡...">
            <input type="time" id="mTime" style="width:100px; color: white;">
            <button class="p-btn" onclick="addMission()">DEPLOY</button>
        </div>
    </div>

    <div class="panel">
        <div class="header">JARVIS CORE // <span>INTELLIGENCE</span></div>
        <div class="terminal" id="jarvisMsg">> æ­£åœ¨ç­‰å¾…æ·±åº¦è®°å¿†åŒæ­¥...</div>
        <div class="input-bar">
            <input type="text" id="chatInput" placeholder="è¾“å…¥å¿ƒæƒ…ã€å·¥ä½œåæ§½..." onkeypress="if(event.key==='Enter') sendChat()">
        </div>
        <button class="p-btn" style="margin-top:10px;" onclick="askJarvis()">è´¾ç»´æ–¯ï¼Œåˆ†æè®°å¿†å¹¶æ‹†è§£ä»»åŠ¡</button>
    </div>

    <script>
        // --- æ ¸å¿ƒé…ç½® ---
        const DEEPSEEK_KEY = 'sk-520f594ef712411d97f24cf387047c1c';
        const API_URL = 'https://api.deepseek.com/chat/completions';

        let state = {
            coins: parseInt(localStorage.getItem('j_coins')) || 1000,
            missions: JSON.parse(localStorage.getItem('j_missions')) || [],
            shop: JSON.parse(localStorage.getItem('j_shop')) || [
                { name: "ä¼‘æ¯15åˆ†é’Ÿ", price: 50, icon: "â˜•" }
            ]
        };

        // --- åˆå§‹åŒ– ---
        function init() {
            renderAll();
            initRadar();
            printTerminal("ç³»ç»Ÿå·²ä¸Šçº¿ã€‚å‡†å¤‡å°±ç»ªï¼Œå…ˆç”Ÿã€‚");
        }

        function renderAll() {
            document.getElementById('coins').innerText = state.coins;
            
            // æ¸²æŸ“ä»»åŠ¡
            const tLine = document.getElementById('timeline');
            tLine.innerHTML = state.missions.map(m => `
                <div class="item-card ${m.done ? 'done' : ''}" onclick="toggleMission(${m.id})">
                    <div><b>${m.time}</b> | ${m.title}</div>
                    <div>${m.done ? 'âœ“' : 'â—'}</div>
                </div>
            `).join('');

            // æ¸²æŸ“å•†åº—
            const sList = document.getElementById('shopList');
            sList.innerHTML = state.shop.map((s, idx) => `
                <div class="item-card" onclick="buyItem(${idx})">
                    <div>${s.icon || 'ğŸ'} ${s.name}</div>
                    <div style="color:var(--g)">-${s.price}</div>
                </div>
            `).join('');

            localStorage.setItem('j_coins', state.coins);
            localStorage.setItem('j_missions', JSON.stringify(state.missions));
            localStorage.setItem('j_shop', JSON.stringify(state.shop));
        }

        // --- ä¸šåŠ¡é€»è¾‘ ---
        function addMission() {
            const title = document.getElementById('mTitle').value;
            const time = document.getElementById('mTime').value || "ASAP";
            if (!title) return;
            state.missions.unshift({ id: Date.now(), title, time, done: false });
            document.getElementById('mTitle').value = '';
            renderAll();
            printTerminal(`æ–°ä»»åŠ¡å·²éƒ¨ç½²åˆ°æ—¶é—´è½´ã€‚`);
        }

        function toggleMission(id) {
            const m = state.missions.find(x => x.id === id);
            if (m && !m.done) {
                m.done = true;
                state.coins += 100;
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                printTerminal("ä»»åŠ¡è¾¾æˆã€‚å¥–åŠ± 100 é‡‘å¸ã€‚");
            } else if (m) {
                m.done = false;
            }
            renderAll();
        }

        function addShopItem() {
            const name = document.getElementById('shopName').value;
            const price = parseInt(document.getElementById('shopPrice').value);
            const icon = document.getElementById('shopIcon').value || "âœ¨";
            if (!name || isNaN(price)) return;
            state.shop.push({ name, price, icon });
            renderAll();
        }

        function buyItem(idx) {
            const item = state.shop[idx];
            if (state.coins >= item.price) {
                state.coins -= item.price;
                printTerminal(`æˆåŠŸå…‘æ¢ï¼š${item.name}ã€‚ç¥æ‚¨æ„‰å¿«ï¼Œå…ˆç”Ÿã€‚`);
                renderAll();
            } else {
                printTerminal("æŠ±æ­‰ï¼Œé‡‘å¸ä¸è¶³ã€‚");
            }
        }

        // --- AI é€»è¾‘ ---
        async function sendChat() {
            const input = document.getElementById('chatInput');
            const msg = input.value;
            if (!msg) return;
            printTerminal(`<span style="color:#fff">ä¸»äºº: ${msg}</span>`);
            input.value = '';
            await callDeepSeek(msg);
        }

        async function askJarvis() {
            const missionStr = state.missions.filter(m => !m.done).map(m => m.title).join(', ');
            const prompt = `æˆ‘ç°åœ¨çš„å¾…åŠä»»åŠ¡æœ‰ï¼š${missionStr || 'æš‚æ— '}ã€‚è¯·å¸®æˆ‘åˆ†æè½»é‡ç¼“æ€¥ï¼Œå¹¶ç»™å‡ºä¸€å¥é¼“åŠ±çš„è¯ã€‚`;
            await callDeepSeek(prompt);
        }

        async function callDeepSeek(text) {
            printTerminal("æ­£åœ¨æ€è€ƒ...");
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${DEEPSEEK_KEY}` },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{ role: "system", content: "ä½ æ˜¯è´¾ç»´æ–¯ï¼Œç§‘æŠ€æ„Ÿåè¶³çš„ç®¡å®¶ã€‚" }, { role: "user", content: text }]
                    })
                });
                const data = await res.json();
                printTerminal(`<span style="color:var(--blue)">JARVIS: ${data.choices[0].message.content}</span>`);
            } catch (e) {
                printTerminal("è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API Key çŠ¶æ€ã€‚");
            }
        }

        function printTerminal(text) {
            const box = document.getElementById('jarvisMsg');
            box.innerHTML += `<div>> ${text}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        function initRadar() {
            const ctx = document.getElementById('radar').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['æ•ˆç‡', 'ä¸“æ³¨', 'åˆ›æ„', 'å¿ƒæ€', 'ä½“èƒ½'],
                    datasets: [{ data: [80, 90, 70, 85, 60], borderColor: '#FF007F', backgroundColor: 'rgba(255,0,127,0.1)' }]
                },
                options: { plugins: { legend: { display: false } }, scales: { r: { grid: { color: '#444' }, ticks: { display: false } } } }
            });
        }

        init();
    </script>
</body>
</html>
