<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Great Me - AI Agent V15.0</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #050505; --card: #121214; --p: #ff4d94; --blue: #00d2ff; --text: #e0e0e0; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; display: grid; grid-template-columns: 350px 1fr 350px; height: 100vh; gap: 20px; padding: 20px; box-sizing: border-box; }
        @media (max-width: 1000px) { body { grid-template-columns: 1fr; height: auto; overflow-y: auto; } }
        .panel { background: var(--card); border-radius: 24px; padding: 25px; border: 1px solid #222; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .panel::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, var(--p), transparent); }
        #dumpArea { flex: 1; overflow-y: auto; margin: 15px 0; }
        .bubble { padding: 15px; border-radius: 15px; margin-bottom: 12px; background: #1a1a1c; border-left: 4px solid #333; font-size: 14px; line-height: 1.6; }
        .pos { border-left-color: var(--blue); background: rgba(0, 210, 255, 0.05); }
        .input-bar { background: #1a1a1c; border-radius: 12px; padding: 5px 15px; display: flex; border: 1px solid #333; }
        input { border: none; background: transparent; flex: 1; padding: 12px; outline: none; color: white; font-size: 15px; }
        .ai-text { font-size: 14px; color: #bbb; background: rgba(0,0,0,0.5); padding: 20px; border-radius: 16px; border: 1px solid #333; line-height: 1.7; flex: 1; }
        button { background: transparent; border: 1px solid var(--p); color: var(--p); padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="panel">
        <h3>ğŸ“Š STATUS / å±æ€§çœ‹æ¿</h3>
        <div style="flex:1; display:flex; align-items:center;"><canvas id="radar"></canvas></div>
        <div style="font-size:24px; font-weight:bold; color:#ffb800; margin-top:10px;">AGENT LV.1</div>
    </div>

    <div class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>ğŸ§  BRAIN DUMP / æ„è¯†æµ</h3>
            <span style="font-size:20px; color:#ffb800;">ğŸª™ <span id="coins">1000</span></span>
        </div>
        <div id="dumpArea"></div>
        <div class="input-bar"><input type="text" id="masterInput" placeholder="è¾“å…¥çµæ„Ÿï¼ŒAI å°†ç»“åˆè®°å¿†åˆ†æ..."></div>
    </div>

    <div class="panel">
        <h3>âœ¨ AI STRATEGIC / æˆ˜ç•¥å»ºè®®</h3>
        <div class="ai-text" id="aiStatus">æ­£åœ¨ç›‘å¬è®°å¿†æµ... è¯·åœ¨ä¸­é—´æ¡†è¾“å…¥å†…å®¹è§¦å‘ AI åˆ†æã€‚</div>
        <button onclick="location.reload()">SYNC / åŒæ­¥è®°å¿†</button>
    </div>

<script>
    const SUPABASE_URL = 'https://zcnmdyvaxrjjhvymjzsb.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_JVEN8RBiF0xuPKl2oVhpQA_rywUiJTY';
    const DEEPSEEK_KEY = 'sk-520f594ef712411d97f24cf387047c1c';

    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function thinkWithAI(newInput) {
        const statusEl = document.getElementById('aiStatus');
        statusEl.innerHTML = "<span style='color:var(--blue)'>âš¡ æ­£åœ¨è°ƒå–äº‘ç«¯è®°å¿†æ€è€ƒä¸­...</span>";
        const { data } = await _supabase.from('life_logs').select('content').order('created_at', { ascending: false }).limit(10);
        const history = data ? data.map(i => i.content).reverse().join(' -> ') : "";

        try {
            const res = await fetch('https://api.deepseek.com/chat/completions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${DEEPSEEK_KEY}` },
                body: JSON.stringify({
                    model: "deepseek-chat",
                    messages: [
                        {role: "system", content: "ä½ æ˜¯ä¸€ä¸ªæ¯’èˆŒä¸”é«˜æ•ˆçš„è¡ŒåŠ¨å¯¼å¸ˆã€‚æ ¹æ®ç”¨æˆ·çš„è®°å¿†æµï¼ŒæŒ‡å‡ºä»–çš„æ‰§è¡Œæ¼æ´å¹¶ç»™å‡ºä¸€ä¸ªå…·ä½“çš„èµšé’±å»ºè®®ã€‚"},
                        {role: "user", content: `å†å²è®°å¿†ï¼š${history} | æœ€æ–°è¾“å…¥ï¼š${newInput}`}
                    ]
                })
            });
            const result = await res.json();
            statusEl.innerText = result.choices[0].message.content;
        } catch (e) { statusEl.innerText = "ğŸš¨ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API é¢åº¦æˆ–ç½‘ç»œã€‚"; }
    }

    async function init() {
        const { data } = await _supabase.from('life_logs').select('*').order('created_at', { ascending: false });
        if (data) {
            const area = document.getElementById('dumpArea');
            area.innerHTML = ''; let coins = 1000;
            data.forEach(log => {
                const div = document.createElement('div');
                div.className = `bubble ${log.category || 'note'}`;
                div.innerText = log.content;
                area.appendChild(div);
                coins += (log.coins || 0);
            });
            document.getElementById('coins').innerText = coins;
        }
    }

    document.getElementById('masterInput').addEventListener('keypress', async (e) => {
        if (e.key === 'Enter' && e.target.value.trim()) {
            const val = e.target.value;
            let type = /(åš|å†™|å‘|èµš|æ‹|å­¦)/.test(val) ? 'pos' : 'note';
            await _supabase.from('life_logs').insert([{ content: val, category: type, coins: type === 'pos' ? 50 : 10 }]);
            e.target.value = '';
            await init();
            thinkWithAI(val);
        }
    });

    init();
    const ctx = document.getElementById('radar').getContext('2d');
    new Chart(ctx, { type: 'radar', data: { labels: ['æ‰§è¡Œ', 'ç›®æ ‡', 'æ´å¯Ÿ', 'åˆ›æ–°', 'æ¢å¤', 'ä¸“æ³¨'], datasets: [{ data: [65, 80, 55, 45, 90, 60], backgroundColor: 'rgba(0, 210, 255, 0.2)', borderColor: '#00d2ff', borderWidth: 2 }] }, options: { scales: { r: { angleLines: { color: '#333' }, grid: { color: '#333' }, pointLabels: { color: '#888' }, ticks: { display: false } } }, plugins: { legend: { display: false } } } });
</script>
</body>
</html>
