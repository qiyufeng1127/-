<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Great Me - ä¼Ÿå¤§ä¹‹æˆ‘ V13.0</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #0a0a0a; --card: #1c1c1e; --p: #ff4d94; --g: #ffb800; --text: #ffffff; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; display: grid; grid-template-columns: 340px 1fr 340px; height: 100vh; gap: 20px; padding: 20px; box-sizing: border-box; }
        .panel { background: var(--card); border-radius: 30px; padding: 25px; display: flex; flex-direction: column; border: 1px solid #333; overflow: hidden; }
        
        /* å±æ€§é›·è¾¾å›¾ */
        #radar { max-height: 250px; margin: 20px 0; }
        
        /* æ ¸å¿ƒè¾“å…¥ä¸æ°”æ³¡ */
        .dump-box { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .bubble { padding: 15px 20px; border-radius: 20px; font-size: 15px; border-left: 6px solid #444; transition: 0.3s; background: #2c2c2e; animation: pop 0.4s ease; }
        .pos { border-color: #339af0; background: rgba(51, 154, 240, 0.1); }
        .neg { border-color: #ff6b6b; background: rgba(255, 107, 107, 0.1); }
        .mood { border-color: #845ef7; background: rgba(132, 94, 247, 0.1); }

        .input-group { background: #2c2c2e; border-radius: 20px; padding: 10px 20px; display: flex; align-items: center; margin-top: 20px; }
        input { background: transparent; border: none; color: white; flex: 1; padding: 10px; outline: none; font-size: 16px; }
        
        .stat-card { background: #2c2c2e; border-radius: 20px; padding: 15px; margin-bottom: 15px; }
        .coin-val { font-size: 28px; font-weight: 800; color: var(--g); }
        @keyframes pop { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: 0; } }
    </style>
</head>
<body>

<div class="panel">
    <div style="color: var(--p); font-weight: bold; font-size: 12px; letter-spacing: 2px;">HQ STRATEGY</div>
    <div style="font-size: 22px; font-weight: 900; margin: 10px 0;">ä¼Ÿå¤§ä¹‹æˆ‘ç³»ç»Ÿ</div>
    <canvas id="radar"></canvas>
    <div class="stat-card">
        <div style="font-size: 12px; color: #888;">ç‰¹å·¥çŠ¶æ€</div>
        <div id="aiStatus" style="font-size: 14px; margin-top: 5px;">æ­£åœ¨ç›‘æµ‹å®æ—¶æ‰§è¡Œç‡...</div>
    </div>
</div>

<div class="panel" style="background: #000; border-color: var(--p);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <span style="font-size: 12px; color: #666;">BRAIN DUMP / æ„è¯†æµæ•æ‰</span>
        <span class="coin-val">ğŸª™ <span id="coins">1250</span></span>
    </div>
    <div class="dump-box" id="dumpArea"></div>
    <div class="input-group">
        <input type="text" id="masterInput" placeholder="æ•æ‰æƒ³æ³•... (Cmd + Enter)">
        <span style="cursor:pointer" onclick="handleInput()">âš¡</span>
    </div>
</div>

<div class="panel">
    <div style="font-weight: bold; margin-bottom: 20px;">ğŸ“Š ä»»åŠ¡åˆ†ç±»å½’æ¡£</div>
    <div id="archive" style="flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:10px;"></div>
    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #333;">
        <button onclick="location.reload()" style="width:100%; padding:12px; border-radius:15px; border:none; background:var(--p); color:white; font-weight:bold;">åŒæ­¥äº‘ç«¯è®°å¿†</button>
    </div>
</div>

<script>
    const SUPABASE_URL = 'https://zcnmdyvaxrjjhvymjzsb.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_JVEN8RBiF0xuPKl2oVhpQA_rywUiJTY';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // åˆå§‹å±æ€§æ•°æ®
    let stats = { exec: 60, goal: 70, insight: 55, creative: 45, recovery: 80, focus: 50 };

    async function init() {
        const { data } = await _supabase.from('life_logs').select('*').order('created_at', { ascending: false });
        if (data) {
            document.getElementById('dumpArea').innerHTML = '';
            let currentCoins = 1250;
            data.forEach(log => {
                renderBubble(log);
                currentCoins += (log.coins || 0);
            });
            document.getElementById('coins').innerText = currentCoins;
            updateAIAdvice(data);
        }
    }

    async function handleInput() {
        const val = document.getElementById('masterInput').value.trim();
        if (!val) return;

        let type = 'note';
        let reward = 0;
        // æ™ºèƒ½åˆ†ç±»é€»è¾‘
        if (/(å†™|åš|å‘|è·‘|å­¦|ç”»|å®Œæˆ|æ–‡æ¡ˆ|å°çº¢ä¹¦)/.test(val)) { type = 'pos'; reward = 50; }
        else if (/(ç„¦è™‘|æ‹–å»¶|ç´¯|ä¸æƒ³)/.test(val)) { type = 'neg'; reward = -100; }
        else if (/(å¿ƒ|æƒ³|è§‰å¾—|çƒ¦)/.test(val)) { type = 'mood'; }

        await _supabase.from('life_logs').insert([{ content: val, category: type, coins: reward }]);
        document.getElementById('masterInput').value = '';
        init();
    }

    function renderBubble(log) {å‡½æ•°renderBubble(log) {
        const div = document.createElement('div');const div = document.createElement('div')ï¼›
        div.className = `bubble ${log.category}`;div.className = ' bubble ${log.category} 'ï¼›
        div.innerText = log.content;
        document.getElementById('dumpArea').appendChild(div);document.getElementById (dumpAreaâ€).appendChild (div);
    }

    function updateAIAdvice(data) {
        const posCount = data.filter(i => i.category === 'pos').length;
        const negCount = data.filter(i => i.category === 'neg').length;
        let advice = "ç›‘æµ‹ä¸­ï¼šå»ºè®®è®°å½•ä¸€æ¡æœ€å°èƒœåˆ©ã€‚";
        if (negCount > posCount) advice = "è­¦å‘Šï¼šæ£€æµ‹åˆ°å¤šæ¡é˜»ç¢ï¼Œè¯·è¿›è¡Œ2åˆ†é’Ÿå†¥æƒ³ã€‚";
        if (posCount > 3) advice = "ç‰¹å·¥è¡¨ç°å‡ºè‰²ï¼Œä»Šæ—¥æ‰§è¡ŒåŠ›è¯„ä»·ï¼šå“è¶Šã€‚";
        document.getElementById('aiStatus').innerText = advice;
    }

    // é›·è¾¾å›¾é…ç½®
    const ctx = document.getElementById('radar').getContext('2d');
    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['æ‰§è¡ŒåŠ›', 'ç›®æ ‡æ„Ÿ', 'æ´å¯ŸåŠ›', 'åˆ›æ–°åŠ›', 'æ¢å¤åŠ›', 'ä¸“æ³¨åŠ›'],
            datasets: [{ data: Object.values(stats), backgroundColor: 'rgba(255, 77, 148, 0.2)', borderColor: '#ff4d94', borderWidth: 2 }]
        },
        options: { scales: { r: { grid: { color: '#333' }, ticks: { display: false }, pointLabels: { color: '#888' } } }, plugins: { legend: { display: false } } }
    });

    document.getElementById('masterInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') handleInput(); });
    init();
</script>
</body>
</html>
